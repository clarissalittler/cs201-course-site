<!DOCTYPE html>
<html lang="en"><head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
<!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/shared/IDEAS-developments/template-columbia/_assets/thirdpartylib/bootstrap-4.3.1/css/bootstrap.min.css">
    <!-- Font Awesome CSS -->
    <link rel="stylesheet" href="/shared/IDEAS-developments/template-columbia/_assets/thirdpartylib/fontawesome-free-5.9.0-web/css/all.min.css">
    <!-- Template CSS -->
    <link rel="stylesheet" href="/shared/IDEAS-developments/template-columbia/_assets/css/styles.min.css">
    <link rel="stylesheet" href="/shared/IDEAS-developments/template-columbia/_assets/css/custom.css">

    <!-- Able Player Dependencies-->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="/shared/videos/ableplayer/thirdparty/js.cookie.js"></script>
    <link rel="stylesheet" href="/shared/videos/ableplayer/build/ableplayer.min.css" type="text/css">
    <script src="/shared/videos/ableplayer/build/ableplayer.min.js"></script>
    <script src="https://player.vimeo.com/api/player.js"></script>
    <script src="https://cdnapisec.kaltura.com/p/823192/sp/82319200/embedIframeJs/uiconf_id/46847663/partner_id/823192"></script>
    <script src="/shared/videos/ableplayer/ablefier.js"></script>
    <style>
          h3 {
			  font-style: italic;
		  }
		  pre {
			  font-weight: bold;
		  }
    </style>
<title>Lesson 5: Processes</title>
</head><body><div class="container-fluid">
<div class="row">
<div class="col-12 banner-img">
<p><img src="img/banner.jpg" alt="banner"></p>
</div>
<div class="col-sm-10 offset-sm-1">
<h1>Lesson 5: Processes</h1>
<h2>Processes</h2>
<p>To understand better how exceptions are handled, it helps to understand the workings of processes. According to the textbook, "A process is the instance of a program in execution". A program is a series of instructions that are run as a process (or as several processes as a program can be executed several times concurrently).</p>
<p>A process runs in a <b>context</b> which consists of the sum total of state (or information) needed to successfully run the process to completion. This state includes:</p>
<ul>
<li>the program’s code and data stored in memory</li>
<li>its program stack</li>
<li>the contents of its general-purpose registers</li>
<li>its program counter</li>
<li>environment variables</li>
<li>the set of open file descriptors</li>
</ul>
<p>When a program name is invoked at the command line (shell), the shell program creates a new process and the context needed to run the process to completion. An application program can also create a new process. this is called <b>forking</b> and will talk more about this in the following sections.</p>
<p>How the operating system handles processes is complex. The textbook only discusses two things the operating system provides processes:</p>
<ul>
<li>logical control flow.</li>
<li>address space.</li>
</ul>
<p>For each process, these are independent from all other processes. This gives the illusion from a process's perspective that they have exclusive use of the CPU and the memory space.</p>
<h3>Logical Control Flow</h3>
<p>This is defined in the book as the series of PC (program counter) values that the CPU runs for just this one process. Basically it's the sequence of instructions a process is running from beginning to end. This is also abbreviated to logical flow.</p>
<p>A process is typically running <b>concurrently</b> with other processes in the system. This means that it's logical flow overlaps in time with other processes. This makes it seem like these processes are running at the same time. However, if they share a CPU, only one process can run at the same time.</p>
<p>How does the operating system and hardware run several processes on the same CPU? This is done by <b>interleaving</b> the running of the processes. Each process takes turns using the CPU and memory for very short imperceptible time intervals.</p>
<p><img src="/content/enforced/387733-cs201_iyer-ou/module-07/img/interleaving.png" alt="Interleaving processes in one CPU"></p>
<p>Above shows a illustration of what interleaving is. There are 4 processes running on one CPU. They take turns running a portion of their instruction set before being <b>preempted</b> which means being suspended for a time. Each 'time splice' has one process running for a variable amount of time. How long and what process to run inext is called <b>scheduling</b> and is decided by the operating system which is run inbetween time splices.</p>
<p>The textbook puts more emphasize on a one CPU system but most modern CPU's have multiple CPU's called <b>cores</b>. The textbook does this for keeping the discussion simple and not having to get in the complex intricacies of scheduling on a multi-core CPU. So the picture of how programs are run is more complex than what's being presented here.</p>
<p>The preempting is done via a hardware interrupt that goes off every few milliseconds. This causes the currently running process to stop running (be preempted), the context is saved and the operating system's kernel is run. This is to allow the operating system to do it's own tasks in-between each process (this is assuming it doesn't run in it's own core). When the operating system is done it will choose another process to run and preempt itself.</p>
<h3>Concurrent Flows</h3>
<p>When one process's execution time overlaps another process's execution time they are said to be <b>concurrent</b>. Concurrency comes in two types: <b>interleaving</b> and <b>parallelism</b>. Interleaving is described as as above. In today's multi-core systems, it's possible to have two processes concurrently run side-by-side (no interleaving) in two different cores. this is called parallel flows, parallel execution or running in parallel.</p>
<h3>Private Address Space</h3>
<p>Each process is run within a private address space that starts with 0 and goes (theoretically) to the size of the system's memory. In reality, the process is not likely to use all of this space and since portions of memory might be reserved for the operating system, it won't be able to use the full memory that the computer has to offer.</p>
<p>The system manages to do this illusion by mapping the program's addresses to actual physical addresses. Each program running at the same time is given a range of the actual memory addresses (usually this is 'growable' or 'shrinkable' depending on what each program needs). These are mapped starting at 0 and going to whatever the process needs. If the program needs more than the allocated memory it's given, part of the memory may be moved to disk to make room for the creation of more memory. So you can have two process's addresses map to the same physical memory location. This is called <b>virtual memory</b>.</p>
<p>Figure 8.13 gives a much fuller view of this private address space. Note that the operating system (or it's main process thread called the <b>kernel</b>) uses a portion of this space to store it's own data, such as IO buffers the process has opened, syscall data, etc. This is inaccessible by the process itself and will throw a segmentation fault if the process tries to access it in any way.</p>
<p><!-- [[ should I copy 8.13 ? ]] --></p>
<h3>User and Kernel Modes</h3>
<p>Ordinary processes need to be restricted in what they can do and access while running; however, the operating system needs full access to everything. So processes can run in two modes: <b>user mode</b> for restricted access and <b>kernel mode</b> for full access. This is determined by a 'mode bit' inside a 'control register' that lets the CPU know whether the process running has access to sensitive parts of memory or can do only restricted tasks.</p>
<p>A process running in kernel mode can execute any instruction in the instruction set and access any memory location in the system. However, a processor in user mode is not allowed to execute privileged instructions that do things such as halt the processor, change the mode bit, or initiate an I/O operation. Nor is it allowed to directly reference code or data in the kernel area of the address space. Any such attempt results in a fatal protection fault. User programs must instead access kernel code and data indirectly via the system call interface.</p>
<p>Initially a process runs in user mode. It can be switched to kernel mode if an exception happens and an exception handler needs to be run. The mode bit is switched and then exception handler is run in kernel mode. Then it is switched back to user mode to continue to run the rest of the process.</p>
<h3>Context Switches</h3>
<p>Every time a process needs to be switched out and in, it's entire state (or 'context') needs to be switched in and out. The context of each process is kept by the kernel in it's part of the memory space. An exception in hardware is used to do context switching.</p>
<p>Switching between processes is called <b>scheduling</b> and this is decided by the kernel's scheduler code.</p>
<p>It's not just interweaving processes on the same core that causes pre-emptive switching. If a process makes a system call, the process is switched out either because the operating system needs to run or because the process will be waiting on some long running action such as reading from the disk. Interrupts and other exceptions will cause processes to be switched out.</p>
<p></p>
<h2><img src="/shared/IDEAS-developments/template-columbia/_assets/icons/lightbulb.svg" alt="" title="" style="padding-right: 10px; max-width: 100%;" data-d2l-editor-default-img-style="true" width="70px">Practice Problems</h2>
</div>
<div class="col-sm-10 offset-sm-1">
<p>Use these practice problems to check your understanding of the content you've been reading. You can try and retry these practice problems as much as you'd like.&nbsp;</p>
<p><iframe src="/d2l/common/dialogs/quickLink/quickLink.d2l?ou=592324&amp;type=lti&amp;rCode=PCCD-6300874" title="M7 L5" allowfullscreen="allowfullscreen" allow="microphone *; camera *; autoplay *" height="600" width="779"></iframe></p>
<footer>End of Lesson 5: Processes</footer></div>
</div>
</div></body></html>