<!DOCTYPE html>
<html lang="en"><head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
<!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/shared/IDEAS-developments/template-columbia/_assets/thirdpartylib/bootstrap-4.3.1/css/bootstrap.min.css">
    <!-- Font Awesome CSS -->
    <link rel="stylesheet" href="/shared/IDEAS-developments/template-columbia/_assets/thirdpartylib/fontawesome-free-5.9.0-web/css/all.min.css">
    <!-- Template CSS -->
    <link rel="stylesheet" href="/shared/IDEAS-developments/template-columbia/_assets/css/styles.min.css">
    <link rel="stylesheet" href="/shared/IDEAS-developments/template-columbia/_assets/css/custom.css">

    <!-- Able Player Dependencies-->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="/shared/videos/ableplayer/thirdparty/js.cookie.js"></script>
    <link rel="stylesheet" href="/shared/videos/ableplayer/build/ableplayer.min.css" type="text/css">
    <script src="/shared/videos/ableplayer/build/ableplayer.min.js"></script>
    <script src="https://player.vimeo.com/api/player.js"></script>
    <script src="https://cdnapisec.kaltura.com/p/823192/sp/82319200/embedIframeJs/uiconf_id/46847663/partner_id/823192"></script>
    <script src="/shared/videos/ableplayer/ablefier.js"></script>
    <style>
          h3 {
			  font-style: italic;
		  }
		  pre {
			  font-weight: bold;
		  }
    </style>
<title>Lesson 8: Arithmetic Operations</title>
</head><body><div class="container-fluid">
<div class="row">
<div class="col-12 banner-img">
<p><img src="img/banner.jpg" alt="banner"></p>
</div>
<div class="col-sm-10 offset-sm-1">
<h1>Lesson 8: Arithmetic Operations</h1>
<p>Up to this point, we have discussed only move instructions. These instructions don't change any values; they just move data around. Now we will discuss instructions that do something with these values.</p>
<h2>Arithmetic Operations: Add, Subtract, Multiply and Divide</h2>
<p>Below is a table (from Figures 3.10 and 3.12) of arithmetic operations. These listed instructions need a one-letter size designator (q, b, l, w) to be added to the end of the instruction name:&nbsp; <code>addq</code>, <code>subl</code>, etc. Also, most instructions will take the source and destination operands, do the operation, and then put the results into the destination, overwriting what is there.</p>
<p>The add and sub instructions work on both signed and unsigned values, whereas <code>imul</code> and <code>idiv</code> are for signed, and <code>mul</code> and <code>div</code> are for unsigned.</p>
<div class="table-responsive">
<table class="table table-bordered">
<thead>
<tr>
<th>Instruction</th>
<th>Effect</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>add S, D</td>
<td style="white-space: nowrap;">D + S -&gt; D</td>
<td>Adds two given operands and puts the result in the second operand.</td>
</tr>
<tr></tr>
<tr>
<td>sub S, D</td>
<td style="white-space: nowrap;">D - S -&gt; D</td>
<td>Subtracts S from D (note this is reverse order of the operands) and puts the result in D.</td>
</tr>
<tr>
<td>imul S, D</td>
<td style="white-space: nowrap;">D x S -&gt; D</td>
<td>Multiplies S and D and puts result in D. This is the normal two operand version. The 'i' indicates this is for signed integers.</td>
</tr>
<tr>
<td>idiv S</td>
<td style="white-space: nowrap;">%rax / S -&gt; %rax<br>%rax mod S -&gt; %rdx</td>
<td>Note this takes only one operand as the second operand is assumed to be the register %rax. It actually does two operations: divide %rax by S and modulo %rax by S. Note that the quotient goes in %rax and the remainder goes in %rdx.</td>
</tr>
<tr>
<td>inc D</td>
<td style="white-space: nowrap;">D + 1 -&gt; D</td>
<td>This takes one operand; the value is incremented by one and then stored back in the same location. It is the equivalent of x++ in C.</td>
</tr>
<tr>
<td>dec D</td>
<td style="white-space: nowrap;">D - 1 -&gt; D</td>
<td>This takes one operand; the value is decremented by one and then stored back in the same location. It is the equivalent of x-- in C.</td>
</tr>
<tr>
<td>neg D</td>
<td style="white-space: nowrap;">D -&gt; -D</td>
<td>This takes one operand; the value is negated and then stored back in the same location. It's similar to doing x = -1*x;</td>
</tr>
</tbody>
</table>
</div>
<p>There is also a one-operand <code>imul</code> version that puts the lower bits of the product in <code>%rax</code> and the upper bits in <code>%rdx</code> to create a possible 128 bit product. This is useful for guarding against overflow, as a product may take up to twice the number of bits to store. Also available are unsigned versions <code>mul</code> and <code>div</code> (note the lack of 'i') for use with unsigned values.</p>
<p>There is one other instruction that is frequently used for doing arithmetic, even though this instruction wasn't designed for this. This is the <code>lea</code> instruction which stands for "load effective address." It's meant to calculate an address and store the calculated address into a register. <b>gcc</b> likes using this to calculate expressions in the form</p>
<p>&nbsp;<code>a + b*x&nbsp;</code></p>
<p>where x is a power of two. The reason why&nbsp;<b>gcc</b> likes using it is because it's much faster than doing a multiplication instruction. Note that the one-letter size only applies to the destination. The source operand always involves 64 bit registers. See the For Loop section for an example of <strong>gcc</strong> using the <code>leal</code> instruction.</p>
<p>For an example of using a <code>leaq</code> instruction (of quad size), if <b>gcc</b> has the C line of code (x is in <code>%rdx</code> and is a long):</p>
<p><code>  x = x*5</code></p>
<p>It might use the instruction:</p>
<p><code>leaq (%rdx, %rdx, 4), %rdx</code></p>
<p>If you recall from earlier,&nbsp;</p>
<p><code>a(b,c,d) -&gt; a+b+c*d&nbsp;</code></p>
<p>So the above instruction will multiply x (in&nbsp;<code>%rdx</code>) by 4 and then add x to get</p>
<p><code>x + x*4 = x*5</code>.</p>
<p>Then, this goes back into x. Notice it may need to modify the original expression slightly to use the <code>leaq</code> instruction.</p>
<p>Also note that, for the two operand instructions in the table above, the first (S) operand can be a constant or immediate value. For example, you can add 10 to what's in <code>%rdx</code> by the following instruction:</p>
<p><code> addq $10, %rdx</code></p>
<p>However, because the instruction has to write to the second (D) operand,&nbsp;<b>the second operand can't be an immediate value;</b> it must be either a register or a memory location if (S) is not a memory location.</p>
</div>
<div class="col-sm-10 offset-sm-1">
<h2><img src="/shared/IDEAS-developments/template-columbia/_assets/icons/lightbulb.svg" alt="" title="" style="padding-right: 10px; max-width: 100%;" width="70px">Practice Problems</h2>
<p>Use these practice problems to check your understanding of the content you've been reading. You can try and retry these practice problems as much as you'd like.&nbsp;</p>
<p><iframe src="/d2l/common/dialogs/quickLink/quickLink.d2l?ou=592324&amp;type=lti&amp;rCode=PCCD-6290985" title="M4 L8" allowfullscreen="allowfullscreen" allow="microphone *; camera *; autoplay *" height="600" width="779"></iframe></p>
<footer>End of Lesson 8: Arithmetic Operations</footer></div>
</div>
</div></body></html>